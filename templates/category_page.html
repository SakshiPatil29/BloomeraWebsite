<!-- templates/category_page.html -->
{% extends "base.html" %}
{% block content %}
<section class="category-section">
<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">{{ category|capitalize }}</h2>
    <form class="d-flex" method="get">
      <input name="price_min" class="form-control me-2" placeholder="Min price" value="{{ request.args.get('price_min','') }}">
      <input name="price_max" class="form-control me-2" placeholder="Max price" value="{{ request.args.get('price_max','') }}">
      <button class="btn btn-outline-dark">Filter</button>
    </form>
  </div>

  <div class="row g-4">
    {% if products %}
      {% for p in products %}
      <div class="col-md-4">
        <div class="card product-card h-100 shadow-sm">
          <img src="{{ url_for('static', filename='images/' ~ (p.image_url or 'placeholder.jpg')) }}" class="card-img-top product-img" alt="{{ p.name }}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ p.name }}</h5>
            <p class="card-text text-muted">{{ p.description[:120] }}</p>
           <div class="mt-auto">
  <strong class="text-success d-block mb-2">₹{{ "%.2f"|format(p.price) }}</strong>
  <div class="d-flex gap-2">
    <button class="btn btn-success add-to-cart" 
        data-name="{{ p.name }}" 
        data-price="{{ p.price }}">
  Add to Cart
</button>

    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#quickView{{ p.id }}">
      Quick View
    </button>
  </div>
</div>


          </div>
        </div>
      </div>

      <!-- Quick view modal -->
      <div class="modal fade" id="quickView{{ p.id }}" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">{{ p.name }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <img src="{{ url_for('static', filename='images/' ~ (p.image_url or 'placeholder.jpg')) }}" class="img-fluid mb-3">
              <p>{{ p.description }}</p>
              <strong class="h4">₹{{ "%.2f"|format(p.price) }}</strong>
            </div>
            <div class="modal-footer">
              <button class="btn btn-success">Add to Cart</button>
              <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      {% endfor %}
    {% else %}
      <p>No products in this category yet.</p>
    {% endif %}
  </div>
</div>
</section>
{% endblock %}
