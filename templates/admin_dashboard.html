{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <div class="d-flex justify-content-between">
    <h2>Admin Dashboard</h2>
    <div>
      <a class="btn btn-outline-secondary me-2" href="{{ url_for('index') }}">View Site</a>
      <a class="btn btn-danger" href="{{ url_for('logout') }}">Logout</a>
    </div>
  </div>

  <hr>

  <div class="card p-4 mb-4">
    <h5>Add New Product</h5>
    <form method="POST" enctype="multipart/form-data" class="row g-3">
      <div class="col-md-6">
        <input name="name" class="form-control" placeholder="Product name" required>
      </div>
      <div class="col-md-3">
        <input type="number" step="0.01" name="price" class="form-control" placeholder="Price" required>
      </div>
      <div class="col-md-3">
        <select name="category" class="form-control" required>
          {% for c in categories %}
            <option value="{{ c }}">{{ c.title() }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-6">
        <input type="file" name="image" class="form-control">
        <small class="text-muted">Allowed: jpg, jpeg, png, webp</small>
      </div>
      <div class="col-md-6">
        <input name="image_url" class="form-control" placeholder="Or type image filename if already uploaded (example.jpg)">
      </div>
      <div class="col-12">
        <textarea name="description" class="form-control" placeholder="Description"></textarea>
      </div>
      <div class="col-12">
        <button class="btn btn-success">Add Product</button>
      </div>
    </form>
  </div>

  <h5>All products</h5>
  <table class="table">
    <thead><tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th></th></tr></thead>
    <tbody>
      {% for p in products %}
      <tr>
        <td><img src="{{ url_for('static', filename='images/' ~ (p.image_url or 'placeholder.jpg')) }}" width="80"></td>
        <td>{{ p.name }}</td>
        <td>{{ p.category }}</td>
        <td>â‚¹{{ "%.2f"|format(p.price) }}</td>
        <td>
          <form method="POST" action="{{ url_for('admin_delete', product_id=p.id) }}" onsubmit="return confirm('Delete product?')">
            <button class="btn btn-sm btn-danger">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
